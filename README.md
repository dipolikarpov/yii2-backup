Yii2-backup
===================
Модуль создания и восстановления резервных копий. Работает в консольном режиме <br />

* Создает резервную копию файлов и БД
* Восстановление резервной копии
* Скачивает бекап с удаленного сайта. Например при переносе, или синхронизации сайтов
* Работает в консольном режиме
* Расписание атоматических бекапов задается чепез крон


Установка
---

Добавить в composer.json
```json
{
	"require": {
  		"svsoft/backup": "*"
	}
}
```
Или
```bash
    composer require svsoft/backup
```

# Конфигурирование

### Базовая конфигурация

Добавить common/config/main.php или другой файл конвигурации:
```php
    'modules'=>[
        'backup' => [
            'class'=>'svsoft\yii\backup\BackupModule',
            'backupsFolder' => '@common/backups', // Directory for backups
            // Directories that will be added to backup
            'directories' => [
                'uploads' => '@frontend/upload/files',
            ],
            'accessToken' => 'XU7iKofYILl0wi2muBxs1EOg25STXG', // tokek for access from url. if not set accces deny
        ],
    ],
```

# Создание бекапа
Выполните команду в консоле
```bash
    ./yii backup/create
```

После выполнения будет создан файл в папке для хранения бекапов, которая указан в конфиге (параметр backupsFolder)

Если папка для бекапов отсутствует, она будет создана автоматически с файлом .gitignore
Бекап состоит из архива БД и архива файлов и папок указанных в конфиге (параметр directories)

# Восстановление бекапа
Выполните команду в консоле
```bash
./yii backup/restore <названия файла бекапа>
```
Будет предложено создать бекап перед восстановлением.
После чего будет восстановлена БД, и файлы у казанные в конфиге

# Скачивание бекапа с удаленного сайта
Выполните команду в консоле
```bash
./yii backup/download <URL сайта> <названия файла бекапа> [токен]
```
Копирут файл бекапа с сайта где установлен этот модуль.
токен не обязательный параметр, по умолчанию подставляет из настрое модуля свойство accessToken. Если один и тотже сайт, 
то параметр токен можно не указывать.
Файл сохраняется в папку бекапов

Список бекапов можно посмотреть выполнив комманду
```bash
./yii backup/list <названия файла бекапа>
```

